<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>12æ ¼ä½ QR Code ç”¢ç”Ÿèˆ‡æƒæç³»çµ±</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <script src='https://unpkg.com/tesseract.js@v2.1.0/dist/tesseract.min.js'></script>
    
    <style>
        body { font-family: 'Microsoft JhengHei', sans-serif; background-color: #f0f2f5; padding: 20px; text-align: center; }
        
        /* æ¨™é¡Œèˆ‡æ§åˆ¶å€ */
        header { margin-bottom: 20px; }
        h2 { color: #333; margin-bottom: 10px; }

        /* æƒæå™¨å€åŸŸ */
        #reader { width: 100%; max-width: 500px; margin: 0 auto; display: none; border: 5px solid #333; }
        #ocr-status { margin: 10px 0; color: #666; font-weight: bold; }

        /* æŒ‰éˆ•æ¨£å¼ */
        .btn-group { margin-bottom: 20px; display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; }
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 15px;
            color: white;
            font-weight: bold;
            transition: 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .btn-scan { background-color: #007bff; }
        .btn-ocr { background-color: #ffc107; color: #333; }
        .btn-gen { background-color: #28a745; }
        .btn-clear { background-color: #dc3545; }
        button:hover { opacity: 0.9; transform: translateY(-1px); }

        /* æ ¼ä½æ’ç‰ˆï¼š12å®®æ ¼ */
        .grid-container {
            display: grid;
            /* æ ¹æ“šè¢å¹•å¯¬åº¦è‡ªå‹•èª¿æ•´ï¼Œæœ€å°å¯¬åº¦ 200px */
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 15px;
            max-width: 1200px;
            margin: 0 auto;
        }

        /* å–®å€‹å¡ç‰‡æ¨£å¼ */
        .grid-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            border: 1px solid #e1e1e1;
        }

        .grid-label {
            font-size: 14px;
            color: #888;
            margin-bottom: 5px;
            align-self: flex-start;
        }

        /* è¼¸å…¥æ¡† */
        input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box; 
            margin-bottom: 10px;
            font-size: 14px;
        }

        /* QR Code é¡¯ç¤ºå€ */
        .qr-display {
            width: 128px;
            height: 128px;
            background-color: #f9f9f9;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 10px;
            border: 1px dashed #ddd; /* é è¨­è™›ç·šæ¡† */
        }
        .qr-display img {
            max-width: 100%;
        }

        /* QR Code ä¸‹æ–¹çš„æ–‡å­—è¨Šæ¯ */
        .qr-text-info {
            font-size: 14px;
            color: #333;
            word-break: break-all; /* é•·æ–‡å­—è‡ªå‹•æ›è¡Œ */
            background: #eef;
            padding: 5px;
            border-radius: 4px;
            width: 100%;
            min-height: 24px;
        }

    </style>
</head>
<body>

    <header>
        <h2>12æ ¼ QR Code ç”¢ç”Ÿèˆ‡æƒæå™¨</h2>
        
        <div class="btn-group">
            <button class="btn-scan" onclick="startQRScan()">ğŸ“¸ æƒæ QR å¡«å…¥</button>
            <button class="btn-ocr" onclick="triggerOCRFile()">ğŸ“„ OCR è¾¨è­˜å¡«å…¥</button>
            <button class="btn-gen" onclick="generateAllQRCodes()">ğŸ”„ æ›´æ–°æ‰€æœ‰ QR Code</button>
            <button class="btn-clear" onclick="clearAll()">ğŸ—‘ï¸ æ¸…é™¤å…¨éƒ¨</button>
            <input type="file" id="ocr-file-input" style="display: none;" accept="image/*" onchange="processOCR(this)">
        </div>
        
        <div id="ocr-status"></div>
        <div id="reader"></div>
    </header>

    <div class="grid-container" id="main-grid">
        </div>

    <script>
        // 1. åˆå§‹åŒ–ï¼šç”¢ç”Ÿ 12 å€‹å¡ç‰‡ä»‹é¢
        const gridContainer = document.getElementById('main-grid');
        
        for (let i = 1; i <= 12; i++) {
            // å»ºç«‹å¡ç‰‡å®¹å™¨
            let itemDiv = document.createElement('div');
            itemDiv.className = 'grid-item';

            // æ¨™ç±¤ (ä¾‹å¦‚ï¼šæ ¼ä½ 1)
            let label = document.createElement('div');
            label.className = 'grid-label';
            label.innerText = 'æ ¼ä½ ' + i;

            // è¼¸å…¥æ¡†
            let input = document.createElement('input');
            input.type = 'text';
            input.id = 'data-' + i;
            input.placeholder = 'è¼¸å…¥è³‡æ–™...';
            // ç•¶ä½¿ç”¨è€…æ‰‹å‹•è¼¸å…¥ä¸¦é›¢é–‹è¼¸å…¥æ¡†æ™‚ï¼Œè‡ªå‹•æ›´æ–°è©²æ ¼çš„ QR
            input.onchange = function() { generateSingleQR(i); };

            // QR Code æ”¾ç½®å€
            let qrDiv = document.createElement('div');
            qrDiv.id = 'qrcode-' + i;
            qrDiv.className = 'qr-display';
            qrDiv.innerText = '(ç­‰å¾…è¼¸å…¥)'; // é è¨­æ–‡å­—

            // QR Code ä¸‹æ–¹æ–‡å­—å€
            let textDiv = document.createElement('div');
            textDiv.id = 'text-info-' + i;
            textDiv.className = 'qr-text-info';

            // çµ„è£
            itemDiv.appendChild(label);
            itemDiv.appendChild(input);
            itemDiv.appendChild(qrDiv);
            itemDiv.appendChild(textDiv);
            gridContainer.appendChild(itemDiv);
        }

        // 2. æ ¸å¿ƒåŠŸèƒ½ï¼šç”¢ç”Ÿæ‰€æœ‰ QR Code
        function generateAllQRCodes() {
            for (let i = 1; i <= 12; i++) {
                generateSingleQR(i);
            }
        }

        // ç”¢ç”Ÿå–®ä¸€æ ¼å­çš„ QR Code
        function generateSingleQR(index) {
            let inputVal = document.getElementById('data-' + index).value.trim();
            let qrContainer = document.getElementById('qrcode-' + index);
            let textContainer = document.getElementById('text-info-' + index);

            // æ¸…ç©ºèˆŠçš„ QR
            qrContainer.innerHTML = "";
            
            // æ›´æ–°ä¸‹æ–¹æ–‡å­—
            textContainer.innerText = inputVal;

            if (inputVal !== "") {
                // ç”¢ç”Ÿæ–°çš„ QR Code
                new QRCode(qrContainer, {
                    text: inputVal,
                    width: 120,
                    height: 120,
                    colorDark : "#000000",
                    colorLight : "#ffffff",
                    correctLevel : QRCode.CorrectLevel.M
                });
            } else {
                qrContainer.innerText = "(ç„¡è³‡æ–™)";
            }
        }

        // 3. æƒæåŠŸèƒ½ (Html5Qrcode)
        let html5QrCode;
        
        function startQRScan() {
            const readerDiv = document.getElementById('reader');
            readerDiv.style.display = "block";
            
            html5QrCode = new Html5Qrcode("reader");
            
            html5QrCode.start(
                { facingMode: "environment" },
                { fps: 10, qrbox: 250 },
                (decodedText) => {
                    // æƒææˆåŠŸ
                    console.log(`Scan result: ${decodedText}`);
                    fillDataAndGenerate(decodedText, false); // å¡«å…¥ä¸¦ç”¢ç”Ÿ
                    stopScan();
                    alert("æƒææˆåŠŸï¼å·²è‡ªå‹•å¡«å…¥ä¸¦ç”¢ç”Ÿ QR Codeã€‚");
                },
                (errorMessage) => { }
            ).catch(err => {
                alert("ç„¡æ³•å•Ÿå‹•ç›¸æ©Ÿï¼Œè«‹ç¢ºèªæ¬Šé™ã€‚");
            });
        }

        function stopScan() {
            if(html5QrCode) {
                html5QrCode.stop().then(() => {
                    document.getElementById('reader').style.display = "none";
                }).catch(err => console.log(err));
            }
        }

        // 4. æ–‡å­—è¾¨è­˜ (OCR)
        function triggerOCRFile() {
            document.getElementById('ocr-file-input').click();
        }

        function processOCR(input) {
            const statusDiv = document.getElementById('ocr-status');
            if (input.files && input.files[0]) {
                statusDiv.innerText = "â³ æ­£åœ¨è¾¨è­˜åœ–ç‰‡æ–‡å­—...";
                
                Tesseract.recognize(
                    input.files[0],
                    'eng+chi_tra', 
                    { logger: m => console.log(m) }
                ).then(({ data: { text } }) => {
                    statusDiv.innerText = "âœ… è¾¨è­˜å®Œæˆï¼";
                    // æ¸…ç†æ–‡å­—
                    let cleanedText = text.replace(/,/g, " "); 
                    fillDataAndGenerate(cleanedText, true);
                });
            }
        }

        // 5. è³‡æ–™å¡«å¯«èˆ‡è‡ªå‹•è§¸ç™¼ç”¢ç”Ÿ
        function fillDataAndGenerate(text, isOCR) {
            let parts;
            // åˆ†å‰²é‚è¼¯ï¼šOCRç”¨ç©ºç™½åˆ‡åˆ†ï¼ŒQR Codeç”¨é€—è™Ÿåˆ‡åˆ† (å¯ä¾éœ€æ±‚ä¿®æ”¹)
            if (isOCR) {
                parts = text.split(/\s+/).filter(item => item.length > 0);
            } else {
                parts = text.split(",");
            }

            // ä¾åºå¡«å…¥æ ¼å­
            for (let i = 0; i < 12; i++) {
                let inputField = document.getElementById('data-' + (i + 1));
                if (parts[i]) {
                    inputField.value = parts[i];
                } else {
                    inputField.value = ""; // å¦‚æœè³‡æ–™ä¸è¶³ï¼Œæ¸…ç©ºå¾Œé¢çš„æ ¼å­
                }
            }
            
            // é‡è¦ï¼šè³‡æ–™å¡«å…¥å¾Œï¼Œé¦¬ä¸Šè§¸ç™¼ç”¢ç”Ÿ QR Code
            generateAllQRCodes();
        }

        function clearAll() {
            for (let i = 1; i <= 12; i++) {
                document.getElementById('data-' + i).value = "";
                document.getElementById('qrcode-' + i).innerHTML = "(ç­‰å¾…è¼¸å…¥)";
                document.getElementById('text-info-' + i).innerText = "";
            }
            document.getElementById('ocr-status').innerText = "";
        }
    </script>
</body>
</html>
